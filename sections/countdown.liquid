{% comment %}
  Standalone Countdown Timer Section
  Configurable end date with days, hours, minutes, seconds display.
{% endcomment %}

{% assign expired = false %}
{% assign end_date = section.settings.end_date %}

<section class="countdown-section" style="
  background-color: {{ section.settings.bg_color }};
  color: {{ section.settings.text_color }};
  padding-top: {{ section.settings.padding_top }}px;
  padding-bottom: {{ section.settings.padding_bottom }}px;
">
  <div class="countdown-container">
    {% if section.settings.title != blank or section.settings.subtitle != blank %}
      <div class="countdown-header">
        {% if section.settings.subtitle != blank %}
          <p class="countdown-subtitle">{{ section.settings.subtitle }}</p>
        {% endif %}
        {% if section.settings.title != blank %}
          <h2 class="countdown-title">{{ section.settings.title }}</h2>
        {% endif %}
      </div>
    {% endif %}

    {% if end_date != blank %}
      <div class="countdown-timer" data-countdown data-end="{{ end_date }}" aria-live="polite">
        <div class="countdown-unit" data-unit="days">
          <span class="countdown-value" data-days>--</span>
          <span class="countdown-label">{{ section.settings.label_days | default: 'Days' }}</span>
        </div>
        <span class="countdown-colon" aria-hidden="true">:</span>
        <div class="countdown-unit" data-unit="hours">
          <span class="countdown-value" data-hours>--</span>
          <span class="countdown-label">{{ section.settings.label_hours | default: 'Hours' }}</span>
        </div>
        <span class="countdown-colon" aria-hidden="true">:</span>
        <div class="countdown-unit" data-unit="minutes">
          <span class="countdown-value" data-minutes>--</span>
          <span class="countdown-label">{{ section.settings.label_minutes | default: 'Minutes' }}</span>
        </div>
        <span class="countdown-colon" aria-hidden="true">:</span>
        <div class="countdown-unit" data-unit="seconds">
          <span class="countdown-value" data-seconds>--</span>
          <span class="countdown-label">{{ section.settings.label_seconds | default: 'Seconds' }}</span>
        </div>
      </div>
      <p class="countdown-expired-msg" data-expired-msg style="display: none;">
        {{ 'sections.countdown.expired' | t | default: 'Offer expired' }}
      </p>
    {% else %}
      <p class="countdown-no-date">Set an end date in section settings.</p>
    {% endif %}
  </div>
</section>

{% stylesheet %}
  .countdown-section {
    text-align: center;
  }

  .countdown-container {
    max-width: var(--content-width);
    margin: 0 auto;
    padding: 0 var(--page-margin);
  }

  .countdown-header {
    margin-bottom: 2rem;
  }

  .countdown-subtitle {
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    opacity: 0.7;
    margin: 0 0 0.5rem;
  }

  .countdown-title {
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 800;
    margin: 0;
    line-height: 1.2;
  }

  .countdown-timer {
    display: inline-flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .countdown-unit {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
  }

  .countdown-value {
    display: block;
    font-size: clamp(2.5rem, 8vw, 4rem);
    font-weight: 900;
    line-height: 1;
    font-variant-numeric: tabular-nums;
    background: rgba(255, 255, 255, 0.15);
    padding: 0.5rem 1rem;
    border-radius: 12px;
    min-width: 1.8ch;
    text-align: center;
  }

  .countdown-label {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-top: 0.5rem;
    opacity: 0.8;
  }

  .countdown-colon {
    font-size: clamp(2rem, 6vw, 3.5rem);
    font-weight: 900;
    opacity: 0.5;
    align-self: center;
    margin-bottom: 1.5rem;
  }

  .countdown-expired-msg {
    font-size: 1.25rem;
    font-weight: 600;
    opacity: 0.8;
  }

  .countdown-no-date {
    opacity: 0.5;
    font-style: italic;
  }

  @media (max-width: 480px) {
    .countdown-timer {
      gap: 0.5rem;
    }

    .countdown-unit {
      min-width: 64px;
    }

    .countdown-colon {
      margin-bottom: 1.75rem;
    }
  }
{% endstylesheet %}

<script>
  (function() {
    document.querySelectorAll('[data-countdown]').forEach(function(el) {
      var endDate = new Date(el.dataset.end);
      var daysEl = el.querySelector('[data-days]');
      var hoursEl = el.querySelector('[data-hours]');
      var minutesEl = el.querySelector('[data-minutes]');
      var secondsEl = el.querySelector('[data-seconds]');
      var expiredMsg = el.parentNode.querySelector('[data-expired-msg]');

      function update() {
        var now = new Date();
        var diff = endDate - now;

        if (diff <= 0) {
          daysEl.textContent = '00';
          hoursEl.textContent = '00';
          minutesEl.textContent = '00';
          secondsEl.textContent = '00';
          el.style.display = 'none';
          if (expiredMsg) expiredMsg.style.display = '';
          return;
        }

        var d = Math.floor(diff / 86400000);
        var h = Math.floor((diff % 86400000) / 3600000);
        var m = Math.floor((diff % 3600000) / 60000);
        var s = Math.floor((diff % 60000) / 1000);

        daysEl.textContent = String(d).padStart(2, '0');
        hoursEl.textContent = String(h).padStart(2, '0');
        minutesEl.textContent = String(m).padStart(2, '0');
        secondsEl.textContent = String(s).padStart(2, '0');
      }

      update();
      setInterval(update, 1000);
    });
  })();
</script>

{% schema %}
{
  "name": "t:sections.countdown.name",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.countdown.settings.title.label",
      "default": "Limited Time Offer"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "t:sections.countdown.settings.subtitle.label",
      "default": "Sale ends in"
    },
    {
      "type": "text",
      "id": "end_date",
      "label": "t:sections.countdown.settings.end_date.label",
      "info": "t:sections.countdown.settings.end_date.info",
      "placeholder": "2025-12-31T23:59:59"
    },
    {
      "type": "header",
      "content": "t:sections.countdown.settings.labels.header"
    },
    {
      "type": "text",
      "id": "label_days",
      "label": "t:sections.countdown.settings.label_days.label",
      "default": "Days"
    },
    {
      "type": "text",
      "id": "label_hours",
      "label": "t:sections.countdown.settings.label_hours.label",
      "default": "Hours"
    },
    {
      "type": "text",
      "id": "label_minutes",
      "label": "t:sections.countdown.settings.label_minutes.label",
      "default": "Minutes"
    },
    {
      "type": "text",
      "id": "label_seconds",
      "label": "t:sections.countdown.settings.label_seconds.label",
      "default": "Seconds"
    },
    {
      "type": "header",
      "content": "t:sections.countdown.settings.style.header"
    },
    {
      "type": "color_background",
      "id": "bg_color",
      "label": "t:sections.countdown.settings.bg_color.label",
      "default": "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "t:sections.countdown.settings.text_color.label",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "t:sections.countdown.settings.spacing.header"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.countdown.settings.padding_top.label",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.countdown.settings.padding_bottom.label",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "t:sections.countdown.presets.name"
    }
  ]
}
{% endschema %}
