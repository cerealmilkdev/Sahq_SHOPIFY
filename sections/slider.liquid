{% comment %}
  Modern Image Slider - Auto-sliding with dots navigation
{% endcomment %}

<section class="slider-section" {{ section.shopify_attributes }}>
  <div class="slider" data-slider data-autoplay="{{ section.settings.autoplay }}" data-interval="{{ section.settings.interval }}">
    <div class="slider__track" data-slider-track>
      {% for block in section.blocks %}
        <div class="slider__slide {% if forloop.first %}slider__slide--active{% endif %}" data-slide="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
          {% if block.settings.image != blank %}
            {{ block.settings.image | image_url: width: 1920 | image_tag: class: 'slider__image', loading: 'lazy' }}
          {% else %}
            <img src="https://picsum.photos/1920/800?random={{ forloop.index }}" alt="Slide {{ forloop.index }}" class="slider__image">
          {% endif %}

          {% if block.settings.heading != blank or block.settings.text != blank or block.settings.button_text != blank %}
            <div class="slider__content">
              {% if block.settings.heading != blank %}
                <h2 class="slider__heading">{{ block.settings.heading }}</h2>
              {% endif %}
              {% if block.settings.text != blank %}
                <p class="slider__text">{{ block.settings.text }}</p>
              {% endif %}
              {% if block.settings.button_text != blank and block.settings.button_link != blank %}
                <a href="{{ block.settings.button_link }}" class="slider__button">{{ block.settings.button_text }}</a>
              {% endif %}
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <!-- Navigation Arrows -->
    <button class="slider__arrow slider__arrow--prev" data-slider-prev aria-label="Previous slide">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>
    <button class="slider__arrow slider__arrow--next" data-slider-next aria-label="Next slide">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>

    <!-- Dots Navigation -->
    <div class="slider__dots" data-slider-dots>
      {% for block in section.blocks %}
        <button class="slider__dot {% if forloop.first %}slider__dot--active{% endif %}" data-dot="{{ forloop.index0 }}" aria-label="Go to slide {{ forloop.index }}"></button>
      {% endfor %}
    </div>
  </div>
</section>

<style>
  .slider-section {
    width: 100%;
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
  }

  .slider {
    position: relative;
    width: 100%;
    height: {{ section.settings.height }}vh;
    overflow: hidden;
    border-radius: {{ section.settings.border_radius }}px;
  }

  .slider__track {
    display: flex;
    height: 100%;
    transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .slider__slide {
    position: relative;
    min-width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.6s ease;
  }

  .slider__slide--active {
    opacity: 1;
  }

  .slider__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .slider__content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 3rem 2rem;
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
    color: white;
    text-align: center;
  }

  .slider__heading {
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 700;
    margin-bottom: 0.75rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }

  .slider__text {
    font-size: clamp(1rem, 2vw, 1.25rem);
    margin-bottom: 1.5rem;
    opacity: 0.9;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .slider__button {
    display: inline-block;
    padding: 0.875rem 2rem;
    background: white;
    color: #111;
    text-decoration: none;
    font-weight: 600;
    border-radius: 50px;
    transition: all 0.3s ease;
  }

  .slider__button:hover {
    background: var(--color-accent, #007bff);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  }

  /* Arrows */
  .slider__arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 48px;
    height: 48px;
    background: rgba(255,255,255,0.9);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  .slider__arrow:hover {
    background: white;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  }

  .slider__arrow--prev {
    left: 1.5rem;
  }

  .slider__arrow--next {
    right: 1.5rem;
  }

  /* Dots */
  .slider__dots {
    position: absolute;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.75rem;
    z-index: 10;
  }

  .slider__dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid white;
    background: transparent;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0;
  }

  .slider__dot:hover {
    background: rgba(255,255,255,0.5);
    transform: scale(1.2);
  }

  .slider__dot--active {
    background: white;
    transform: scale(1.2);
  }

  /* Progress bar (optional) */
  .slider__progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    background: var(--color-accent, #007bff);
    transition: width linear;
    z-index: 10;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .slider__arrow {
      width: 40px;
      height: 40px;
    }

    .slider__arrow--prev {
      left: 0.75rem;
    }

    .slider__arrow--next {
      right: 0.75rem;
    }

    .slider__content {
      padding: 2rem 1rem;
    }

    .slider__dots {
      bottom: 1rem;
    }

    .slider__dot {
      width: 10px;
      height: 10px;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .slider__track {
      transition: none;
    }

    .slider__slide {
      transition: none;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sliders = document.querySelectorAll('[data-slider]');

    sliders.forEach(slider => {
      const track = slider.querySelector('[data-slider-track]');
      const slides = slider.querySelectorAll('[data-slide]');
      const dots = slider.querySelectorAll('[data-dot]');
      const prevBtn = slider.querySelector('[data-slider-prev]');
      const nextBtn = slider.querySelector('[data-slider-next]');
      const autoplay = slider.dataset.autoplay === 'true';
      const interval = parseInt(slider.dataset.interval) || 5000;

      let currentIndex = 0;
      let autoplayTimer = null;

      function goToSlide(index) {
        if (index < 0) index = slides.length - 1;
        if (index >= slides.length) index = 0;

        slides.forEach((slide, i) => {
          slide.classList.toggle('slider__slide--active', i === index);
        });

        dots.forEach((dot, i) => {
          dot.classList.toggle('slider__dot--active', i === index);
        });

        track.style.transform = `translateX(-${index * 100}%)`;
        currentIndex = index;
      }

      function nextSlide() {
        goToSlide(currentIndex + 1);
      }

      function prevSlide() {
        goToSlide(currentIndex - 1);
      }

      function startAutoplay() {
        if (autoplay) {
          autoplayTimer = setInterval(nextSlide, interval);
        }
      }

      function stopAutoplay() {
        if (autoplayTimer) {
          clearInterval(autoplayTimer);
          autoplayTimer = null;
        }
      }

      // Event listeners
      prevBtn?.addEventListener('click', () => {
        prevSlide();
        stopAutoplay();
        startAutoplay();
      });

      nextBtn?.addEventListener('click', () => {
        nextSlide();
        stopAutoplay();
        startAutoplay();
      });

      dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
          goToSlide(index);
          stopAutoplay();
          startAutoplay();
        });
      });

      // Pause on hover
      slider.addEventListener('mouseenter', stopAutoplay);
      slider.addEventListener('mouseleave', startAutoplay);

      // Touch/swipe support
      let touchStartX = 0;
      let touchEndX = 0;

      slider.addEventListener('touchstart', e => {
        touchStartX = e.changedTouches[0].screenX;
        stopAutoplay();
      }, { passive: true });

      slider.addEventListener('touchend', e => {
        touchEndX = e.changedTouches[0].screenX;
        const diff = touchStartX - touchEndX;

        if (Math.abs(diff) > 50) {
          if (diff > 0) {
            nextSlide();
          } else {
            prevSlide();
          }
        }
        startAutoplay();
      }, { passive: true });

      // Keyboard navigation
      slider.setAttribute('tabindex', '0');
      slider.addEventListener('keydown', e => {
        if (e.key === 'ArrowLeft') prevSlide();
        if (e.key === 'ArrowRight') nextSlide();
      });

      // Start autoplay
      startAutoplay();
    });
  });
</script>

{% schema %}
{
  "name": "Image Slider",
  "tag": "section",
  "class": "section-slider",
  "settings": [
    {
      "type": "range",
      "id": "height",
      "min": 30,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "label": "Slider height",
      "default": 60
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 0
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-play slides",
      "default": true
    },
    {
      "type": "range",
      "id": "interval",
      "min": 2000,
      "max": 9000,
      "step": 1000,
      "unit": "ms",
      "label": "Slide interval",
      "default": 5000
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Padding top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Padding bottom",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Slide Title"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Description"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image Slider",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "heading": "New Collection",
            "text": "Discover our latest arrivals",
            "button_text": "Shop Now"
          }
        },
        {
          "type": "slide",
          "settings": {
            "heading": "Summer Sale",
            "text": "Up to 50% off selected items",
            "button_text": "View Deals"
          }
        },
        {
          "type": "slide",
          "settings": {
            "heading": "Free Shipping",
            "text": "On orders over $50",
            "button_text": "Learn More"
          }
        }
      ]
    }
  ]
}
{% endschema %}
