{% comment %}
  Modern Grid Product/Gallery Section
  A highly customizable grid for showcasing products or curated images.
{% endcomment %}

{% liquid
  assign columns_desktop = section.settings.columns_desktop
  assign columns_mobile = section.settings.columns_mobile
  assign gap = section.settings.gap
  assign border_radius = section.settings.border_radius
  assign aspect_ratio = section.settings.aspect_ratio
  assign hover_effect = section.settings.hover_effect
  assign card_style = section.settings.card_style
%}

<style>
  .section-{{ section.id }} {
    --grid-gap: {{ gap }}px;
    --card-radius: {{ border_radius }}px;
    background-color: {{ section.settings.bg_color }};
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }

  .grid-product__container {
    display: grid;
    gap: var(--grid-gap);
    grid-template-columns: repeat({{ columns_mobile }}, minmax(0, 1fr));
  }

  @media screen and (min-width: 768px) {
    .grid-product__container {
      grid-template-columns: repeat({{ columns_desktop | minus: 1 | at_least: 2 }}, minmax(0, 1fr));
    }
  }

  @media screen and (min-width: 1024px) {
    .grid-product__container {
      grid-template-columns: repeat({{ columns_desktop }}, minmax(0, 1fr));
    }
  }

  .grid-product__item {
    position: relative;
    border-radius: var(--card-radius);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .grid-product__image-wrapper {
    position: relative;
    width: 100%;
    overflow: hidden;
    background-color: #f3f4f6;
    {% if aspect_ratio != 'auto' %}
      aspect-ratio: {{ aspect_ratio }};
    {% endif %}
  }

  .grid-product__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Hover Effects */
  {% if hover_effect == 'zoom' %}
    .grid-product__item:hover .grid-product__image {
      transform: scale(1.1);
    }
  {% elsif hover_effect == 'lift' %}
    .grid-product__item:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    }
  {% endif %}

  /* Card Styles */
  {% if card_style == 'outline' %}
    .grid-product__item {
      border: 1px solid rgba(0,0,0,0.1);
    }
  {% elsif card_style == 'shadow' %}
    .grid-product__item {
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }
  {% endif %}

  .grid-product__badge {
    position: absolute;
    top: 12px;
    left: 12px;
    z-index: 10;
    padding: 4px 12px;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 99px;
    background: {{ section.settings.badge_bg_color }};
    color: {{ section.settings.badge_text_color }};
  }

  .grid-product__content {
    padding: 1rem;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: {{ section.settings.content_alignment }};
    text-align: {{ section.settings.content_alignment }};
  }

  .grid-product__title {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--color-foreground);
    line-height: 1.4;
  }

  .grid-product__price {
    font-weight: 500;
    color: var(--color-accent);
  }

  .grid-product__overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: flex-end;
    padding: 1.5rem;
    color: white;
  }

  .grid-product__item:hover .grid-product__overlay {
    opacity: 1;
  }
</style>

<div class="section-{{ section.id }} overflow-hidden">
  <div class="max-w-[1400px] mx-auto px-4 md:px-8">
    
    {% if section.settings.title != blank or section.settings.subtitle != blank %}
      <div class="mb-10 md:mb-16 text-{{ section.settings.heading_align }}">
        {% if section.settings.subtitle != blank %}
          <span class="inline-block text-primary font-bold tracking-widest uppercase text-xs md:text-sm mb-3">{{ section.settings.subtitle }}</span>
        {% endif %}
        {% if section.settings.title != blank %}
          <h2 class="text-3xl md:text-5xl lg:text-6xl font-black tracking-tight text-foreground mb-6">{{ section.settings.title }}</h2>
        {% endif %}
      </div>
    {% endif %}

    <div class="grid-product__container">
      {% for block in section.blocks %}
        <div class="grid-product__item group" {{ block.shopify_attributes }}>
          {% case block.type %}
            {% when 'image' %}
              {% if block.settings.link != blank %}
                <a href="{{ block.settings.link }}" class="absolute inset-0 z-20"></a>
              {% endif %}
              
              <div class="grid-product__image-wrapper">
                {% if block.settings.badge != blank %}
                  <span class="grid-product__badge">{{ block.settings.badge }}</span>
                {% endif %}

                {% if block.settings.image %}
                  {% render 'image',
                    image: block.settings.image,
                    class: 'grid-product__image',
                    width: 800
                  %}
                {% else %}
                  {{ 'image' | placeholder_svg_tag: 'w-full h-full bg-gray-200' }}
                {% endif %}

                {% if section.settings.style == 'overlay' %}
                  <div class="grid-product__overlay">
                    <div>
                      <h3 class="text-xl font-bold mb-1">{{ block.settings.title }}</h3>
                      <p class="text-sm opacity-80">{{ block.settings.caption }}</p>
                    </div>
                  </div>
                {% endif %}
              </div>

              {% if section.settings.style == 'standard' %}
                <div class="grid-product__content">
                  <h3 class="grid-product__title">{{ block.settings.title }}</h3>
                  {% if block.settings.caption != blank %}
                    <p class="text-sm opacity-60 line-clamp-2">{{ block.settings.caption }}</p>
                  {% endif %}
                </div>
              {% endif %}

            {% when 'product' %}
              {% assign product = block.settings.product %}
              {% if product != blank %}
                <a href="{{ product.url }}" class="absolute inset-0 z-20"></a>
                
                <div class="grid-product__image-wrapper">
                  {% if product.compare_at_price > product.price %}
                    <span class="grid-product__badge">Sale</span>
                  {% endif %}

                  {% render 'image',
                    image: product.featured_image,
                    class: 'grid-product__image',
                    width: 800
                  %}
                </div>

                <div class="grid-product__content">
                  <h3 class="grid-product__title">{{ product.title }}</h3>
                  <div class="grid-product__price">
                    {{ product.price | money }}
                    {% if product.compare_at_price > product.price %}
                      <span class="text-sm line-through opacity-50 ml-2">{{ product.compare_at_price | money }}</span>
                    {% endif %}
                  </div>
                </div>
              {% else %}
                <div class="grid-product__image-wrapper">
                  {{ 'product-1' | placeholder_svg_tag: 'w-full h-full bg-gray-200' }}
                </div>
                <div class="grid-product__content">
                  <h3 class="grid-product__title">Sample Product</h3>
                  <p class="grid-product__price">$19.99</p>
                </div>
              {% endif %}
          {% endcase %}
        </div>
      {% endfor %}
    </div>

    {% if section.settings.button_label != blank %}
      <div class="mt-12 md:mt-20 text-center">
        <a href="{{ section.settings.button_link }}" class="inline-flex items-center justify-center px-10 py-4 bg-primary text-white font-bold rounded-full transition-transform hover:scale-105 active:scale-95 shadow-xl shadow-primary/20">
          {{ section.settings.button_label }}
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
        </a>
      </div>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Modern Product Grid",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Featured Collection"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Sub-heading",
      "default": "New Arrivals"
    },
    {
      "type": "select",
      "id": "heading_align",
      "label": "Heading Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Grid Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 6,
      "step": 1,
      "label": "Columns (Desktop)",
      "default": 4
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Columns (Mobile)",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ],
      "default": "2"
    },
    {
      "type": "range",
      "id": "gap",
      "min": 0,
      "max": 60,
      "step": 4,
      "label": "Gap between items",
      "default": 24,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Card Style"
    },
    {
      "type": "select",
      "id": "style",
      "label": "Card Layout",
      "options": [
        { "value": "standard", "label": "Standard (Info below)" },
        { "value": "overlay", "label": "Overlay (Info on hover)" }
      ],
      "default": "standard"
    },
    {
      "type": "select",
      "id": "card_style",
      "label": "Card Visual Style",
      "options": [
        { "value": "none", "label": "Clean" },
        { "value": "outline", "label": "Outline" },
        { "value": "shadow", "label": "Soft Shadow" }
      ],
      "default": "none"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Image Aspect Ratio",
      "options": [
        { "value": "auto", "label": "Natural" },
        { "value": "1/1", "label": "Square (1:1)" },
        { "value": "4/5", "label": "Portrait (4:5)" },
        { "value": "16/9", "label": "Landscape (16:9)" }
      ],
      "default": "4/5"
    },
    {
      "type": "select",
      "id": "hover_effect",
      "label": "Hover Effect",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "zoom", "label": "Zoom Image" },
        { "value": "lift", "label": "Lift Card" }
      ],
      "default": "zoom"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 40,
      "step": 4,
      "label": "Corner Radius",
      "default": 12,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "content_alignment",
      "label": "Content Alignment",
      "options": [
        { "value": "flex-start", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "flex-start"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Section Background",
      "default": "transparent"
    },
    {
      "type": "color",
      "id": "badge_bg_color",
      "label": "Badge Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Badge Text",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Footer Button"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "label": "Padding Top",
      "default": 60,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "label": "Padding Bottom",
      "default": 60,
      "unit": "px"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Custom Card",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Curated Item"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Caption",
          "default": "Short description here"
        },
        {
          "type": "text",
          "id": "badge",
          "label": "Badge Text",
          "placeholder": "NEW"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    },
    {
      "type": "product",
      "name": "Product Card",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Select Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Modern Product Grid",
      "blocks": [
        { "type": "product" },
        { "type": "product" },
        { "type": "product" },
        { "type": "product" }
      ]
    }
  ]
}
{% endschema %}
